!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).JoystickController=i()}(this,(function(){"use strict";return class{constructor(t,i){this.JOYSTICK_TRANSITION="border-radius 0.2s ease-in-out",this.options={maxRange:100,level:10,radius:50,joystickRadius:30,opacity:.8,leftToRight:!0,bottomToUp:!0,containerClass:"",controllerClass:"",joystickClass:"",x:"50%",y:"50%",distortion:!1,dynamicPosition:!1},this.onMove=void 0,this.x=0,this.y=0,this.leveledX=0,this.leveledY=0,this.angle=0,this.distance=0,this.style=void 0,this.id=void 0,this.container=void 0,this.controller=void 0,this.joystick=void 0,this.centerX=void 0,this.centerY=void 0,this.started=void 0,this.addEventListeners=()=>{this.options.dynamicPosition?(document.addEventListener("mousedown",this.dynamicPositioningMouse),document.addEventListener("mouseup",this.removeDynamicPositioning),document.addEventListener("touchstart",this.dynamicPositioningTouch),document.addEventListener("touchmove",this.onTouchEvent,{passive:!1}),document.addEventListener("touchend",this.removeDynamicPositioning)):(this.joystick.addEventListener("touchstart",this.onStartEvent),this.joystick.addEventListener("touchmove",this.onTouchEvent),this.joystick.addEventListener("touchend",this.onStopEvent),this.joystick.addEventListener("mousedown",this.onStartEvent)),window.addEventListener("resize",this.recenterJoystick)},this.dynamicPositioningMouse=t=>{const i=t.clientY;this.container.style.left=t.clientX+"px",this.container.style.top=i+"px",this.container.style.bottom="unset",this.container.style.right="unset",document.body.appendChild(this.container),this.recenterJoystick(),this.onStartEvent(t)},this.dynamicPositioningTouch=t=>{let i;if(t.touches.length>1)for(let e=0;t.touches.length>e;e++){const s=t.touches.item(e);s.target===this.joystick&&(i=s)}else i=t.touches[0];const e=i.clientY;this.container.style.left=i.clientX+"px",this.container.style.top=e+"px",this.container.style.bottom="unset",this.container.style.right="unset",document.body.appendChild(this.container),this.recenterJoystick(),this.onStartEvent(t)},this.removeDynamicPositioning=t=>{this.onStopEvent(t),this.container.remove()},this.updateCoordinates=(t,i)=>{this.distance=Math.sqrt(Math.pow(t-this.centerX,2)+Math.pow(i-this.centerY,2)).toFixed(4),this.angle=Math.atan2(i-this.centerY,t-this.centerX).toFixed(4);const e=this.distance>this.options.maxRange?this.options.maxRange:this.distance;this.x=Math.round(Math.cos(this.angle)*e),this.y=-Math.round(Math.sin(this.angle)*e),this.leveledX=Math.round(this.x/this.options.maxRange*this.options.level),this.leveledY=Math.round(this.y/this.options.maxRange*this.options.level),this.joystick.style.left=this.options.radius+this.x+"px",this.joystick.style.bottom=this.options.radius+this.y+"px",this.options.distortion&&this.distortJoystick(),this.onMove&&this.onMove({x:this.x,y:this.y,leveledX:this.leveledX,leveledY:this.leveledY,distance:this.distance,angle:this.angle})},this.resetCoordinates=()=>{this.x=0,this.y=0,this.leveledX=0,this.leveledY=0,this.angle=0,this.distance=0,this.joystick.style.left=this.options.radius+"px",this.joystick.style.bottom=this.options.radius+"px",this.options.distortion&&this.distortJoystick(),this.onMove&&this.onMove({x:this.x,y:this.y,leveledX:this.leveledX,leveledY:this.leveledY,distance:this.distance,angle:this.angle})},this.distortJoystick=()=>{this.distance>.7*this.options.maxRange?(this.joystick.style.borderRadius="70% 80% 70% 15%",this.joystick.style.transform=`translate(-50%, 50%) rotate(${+this.angle+Math.PI/4}rad)`):(this.joystick.style.borderRadius="50%",this.joystick.style.transform=`translate(-50%, 50%) rotate(${Math.PI/4}rad})`)},this.onStartEvent=t=>{this.started=!0,"mousedown"===t.type&&(window.addEventListener("mousemove",this.onMouseEvent),window.addEventListener("mouseup",this.onStopEvent)),this.joystick.style.transition=this.JOYSTICK_TRANSITION,this.joystick.style.cursor="grabbing"},this.onStopEvent=t=>{this.started=!1,"mouseup"===t.type&&(window.removeEventListener("mousemove",this.onMouseEvent),window.removeEventListener("mouseup",this.onStopEvent)),this.joystick.style.transition="all 0.2s ease-in-out",this.joystick.style.cursor="grab",this.resetCoordinates()},this.onTouchEvent=t=>{let i;if(t.preventDefault(),t.touches.length>1)for(let e=0;t.touches.length>e;e++){const s=t.touches.item(e);s.target===this.joystick&&(i=s)}else i=t.touches[0];this.updateCoordinates(i.clientX,i.clientY)},this.onMouseEvent=t=>{if(!this.started)return;t.preventDefault();this.updateCoordinates(t.clientX,t.clientY)},this.recenterJoystick=()=>{this.centerX=this.controller.getBoundingClientRect().left+this.options.radius,this.centerY=this.controller.getBoundingClientRect().top+this.options.radius},this.options=Object.assign(this.options,t),this.onMove=i,this.validate(),this.init()}validate(){if(window.__active_joysticks__&&window.__active_joysticks__.length>0&&this.options.dynamicPosition)throw Error("You can't have multiple joysticks on the screen if there's a joystick with dynamic position.")}init(){this.id=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),window.__active_joysticks__=Object.assign(window.__active_joysticks__||[],[this]),this.style=document.createElement("style"),this.style.setAttribute("id","style-"+this.id),this.style.innerHTML=`\n        .joystick-container-${this.id} {\n            box-sizing: border-box;\n            position: fixed;\n            outline: none;\n            ${this.options.leftToRight?"left":"right"}: ${this.options.x};\n            ${this.options.bottomToUp?"bottom":"top"}: ${this.options.y};\n            transform: translate(${this.options.dynamicPosition||this.options.leftToRight?"-50%":"50%"}, ${this.options.dynamicPosition||!this.options.bottomToUp?"-50%":"50%"});\n        }\n    \n        .joystick-controller-${this.id} {\n            box-sizing: border-box;\n            outline: none;\n            opacity: ${this.options.opacity};\n            width: ${2*this.options.radius}px;\n            height: ${2*this.options.radius}px;\n            border-radius: 50%;\n            position: relative;\n            outline: 2px solid #4c4c4c77;\n            background: radial-gradient(circle,#ebebeb55, #5c5c5c55);\n        }\n    \n        .joystick-${this.id} {\n            box-sizing: border-box;\n            outline: none;\n            position: absolute;\n            cursor: grab;\n            width: ${2*this.options.joystickRadius}px;\n            height: ${2*this.options.joystickRadius}px;\n            z-index: 1;\n            border-radius: 50%;\n            left: 50%;\n            bottom: 50%;\n            transform: translate(-50%, 50%);\n            background: radial-gradient(#000c, #3e3f46aa);\n            transition: ${this.JOYSTICK_TRANSITION};\n        }\n        `,this.container=document.createElement("div"),this.container.setAttribute("id","joystick-container-"+this.id),this.container.setAttribute("class","joystick-container-"+this.id+" "+this.options.containerClass),this.controller=document.createElement("div"),this.controller.setAttribute("id","joystick-controller-"+this.id),this.controller.setAttribute("class","joystick-controller-"+this.id+" "+this.options.controllerClass),this.joystick=document.createElement("div"),this.joystick.setAttribute("id","joystick-"+this.id),this.joystick.setAttribute("class","joystick-"+this.id+" "+this.options.joystickClass),this.controller.appendChild(this.joystick),this.container.appendChild(this.controller),document.head.appendChild(this.style),!this.options.dynamicPosition&&document.body.appendChild(this.container),this.addEventListeners(),this.recenterJoystick(),this.resetCoordinates()}destroy(){this.options.dynamicPosition?(document.removeEventListener("mousedown",this.dynamicPositioningMouse),document.removeEventListener("mouseup",this.removeDynamicPositioning),document.removeEventListener("touchstart",this.dynamicPositioningTouch),document.removeEventListener("touchmove",this.onTouchEvent,{passive:!1}),document.removeEventListener("touchend",this.removeDynamicPositioning)):(this.joystick.removeEventListener("touchstart",this.onStartEvent),this.joystick.removeEventListener("touchmove",this.onTouchEvent),this.joystick.removeEventListener("touchend",this.onStopEvent),this.joystick.removeEventListener("mousedown",this.onStartEvent)),window.removeEventListener("resize",this.recenterJoystick),document.head.removeChild(this.style),document.body.removeChild(this.container),Array.isArray(window.__active_dynamic_joystick__)&&(window.__active_dynamic_joystick__=window.__active_dynamic_joystick__.filter((t=>t!==this)))}}}));
