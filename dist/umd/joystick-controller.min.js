!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).JoystickController={})}(this,(function(t){"use strict";var e="__joysticks_identifiers__",n="__active_joysticks__",i={ALL:-1,LEFT:0,MIDDLE:1,RIGHT:2},o=function(){function t(t,n){var o=this;this.JOYSTICK_TRANSITION="border-radius 0.2s ease-in-out",this.options={maxRange:100,level:10,radius:50,joystickRadius:30,opacity:.8,leftToRight:!0,bottomToUp:!0,containerClass:"",controllerClass:"",joystickClass:"",x:"50%",y:"50%",distortion:!1,dynamicPosition:!1,dynamicPositionTarget:null,mouseClickButton:-1,hideContextMenu:!1},this.x=0,this.y=0,this.leveledX=0,this.leveledY=0,this.angle=0,this.distance=0,this.started=!1,this.identifier=null,this.mouseButton=-1,this.addEventListeners=function(){var t=o.options.mouseClickButton;if(("string"==typeof t&&Object.keys(i).includes(t)||"number"==typeof t&&6>t&&t>-2)&&(o.mouseButton="string"==typeof t?i[t]:t),o.options.dynamicPosition){var e=o.options.dynamicPositionTarget||document;e.addEventListener("mousedown",o.dynamicPositioningMouse),document.addEventListener("mouseup",o.removeDynamicPositioning),e.addEventListener("touchstart",o.dynamicPositioningTouch),document.addEventListener("touchmove",o.onTouchEvent,{passive:!1}),document.addEventListener("touchend",o.removeDynamicPositioning),o.options.hideContextMenu&&(e.addEventListener("contextmenu",(function(t){return t.preventDefault()})),o.joystick.addEventListener("contextmenu",(function(t){return t.preventDefault()})))}else o.joystick.addEventListener("touchstart",o.onStartEvent),o.joystick.addEventListener("touchmove",o.onTouchEvent),o.joystick.addEventListener("touchend",o.onStopEvent),o.joystick.addEventListener("mousedown",o.onStartEvent),o.options.hideContextMenu&&(o.container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),o.joystick.addEventListener("contextmenu",(function(t){return t.preventDefault()})));window.addEventListener("resize",o.recenterJoystick)},this.dynamicPositioningMouse=function(t){if(null===o.identifier&&(-1===o.mouseButton||t.button===o.mouseButton)){var n=t.x+"-"+t.y;if(!window[e].has(n)){o.identifier=n,window[e].add(o.identifier);var i=t.clientY;o.container.style.left=t.clientX+"px",o.container.style.top=i+"px",o.container.style.bottom="unset",o.container.style.right="unset",document.body.appendChild(o.container),o.recenterJoystick(),o.onStartEvent(t,!1)}}},this.dynamicPositioningTouch=function(t){if(null===o.identifier){var n=t.changedTouches[0].identifier;if(!window[e].has(n)){var i;o.identifier=n,window[e].add(n);for(var s=0;t.touches.length>s;s++){var r=t.touches.item(s);if(o.identifier===(null==r?void 0:r.identifier)){i=r;break}}if(i){var c=i.clientY;o.container.style.left=i.clientX+"px",o.container.style.top=c+"px",o.container.style.bottom="unset",o.container.style.right="unset",document.body.appendChild(o.container),o.recenterJoystick(),o.onStartEvent(t,!1)}}}},this.removeDynamicPositioning=function(t){if(null!==o.identifier){if("touchend"===t.type){if(o.identifier!==t.changedTouches[0].identifier)return}else if(-1!==o.mouseButton&&t.button!==o.mouseButton)return;window[e].delete(o.identifier),o.identifier=null,o.onStopEvent(t),o.container.remove()}},this.updateCoordinates=function(t,e){o.distance=+Math.sqrt(Math.pow(t-o.centerX,2)+Math.pow(e-o.centerY,2)).toFixed(4),o.angle=+Math.atan2(e-o.centerY,t-o.centerX).toFixed(4);var n=o.distance>o.options.maxRange?o.options.maxRange:o.distance;o.x=Math.round(Math.cos(o.angle)*n),o.y=-Math.round(Math.sin(o.angle)*n),o.leveledX=Math.round(o.x/o.options.maxRange*o.options.level),o.leveledY=Math.round(o.y/o.options.maxRange*o.options.level),o.joystick.style.left=o.options.radius+o.x+"px",o.joystick.style.bottom=o.options.radius+o.y+"px",o.options.distortion&&o.distortJoystick(),o.onMove&&o.onMove({x:o.x,y:o.y,leveledX:o.leveledX,leveledY:o.leveledY,distance:o.distance,angle:o.angle})},this.resetCoordinates=function(){o.x=0,o.y=0,o.leveledX=0,o.leveledY=0,o.angle=0,o.distance=0,o.joystick.style.left=o.options.radius+"px",o.joystick.style.bottom=o.options.radius+"px",o.options.distortion&&o.distortJoystick(),o.onMove&&o.onMove({x:o.x,y:o.y,leveledX:o.leveledX,leveledY:o.leveledY,distance:o.distance,angle:o.angle})},this.distortJoystick=function(){o.distance>.7*o.options.maxRange?(o.joystick.style.borderRadius="70% 80% 70% 15%",o.joystick.style.transform="translate(-50%, 50%) rotate(".concat(+o.angle+Math.PI/4,"rad)")):(o.joystick.style.borderRadius="50%",o.joystick.style.transform="translate(-50%, 50%) rotate(0.7853981633974483rad})")},this.onStartEvent=function(t,e){if(void 0===e&&(e=!0),"mousedown"===t.type){if(-1!==o.mouseButton&&t.button!==o.mouseButton)return;window.addEventListener("mousemove",o.onMouseEvent),window.addEventListener("mouseup",o.onStopEvent)}else if(e){o.identifier=t.changedTouches[0].identifier}o.started=!0,o.joystick.style.transition=o.JOYSTICK_TRANSITION,o.joystick.style.cursor="grabbing"},this.onStopEvent=function(t){if("mouseup"===t.type){if(-1!==o.mouseButton&&t.button!==o.mouseButton)return;window.removeEventListener("mousemove",o.onMouseEvent),window.removeEventListener("mouseup",o.onStopEvent)}else o.identifier=null;o.started=!1,o.joystick.style.transition="all 0.2s ease-in-out",o.joystick.style.cursor="grab",o.resetCoordinates()},this.onTouchEvent=function(t){for(var e,n=0;t.touches.length>n;n++){var i=t.touches.item(n);if(o.identifier===(null==i?void 0:i.identifier)){e=i;break}}e&&(t.preventDefault(),o.updateCoordinates(e.clientX,e.clientY))},this.onMouseEvent=function(t){o.started&&(t.preventDefault(),o.updateCoordinates(t.clientX,t.clientY))},this.recenterJoystick=function(){o.centerX=o.controller.getBoundingClientRect().left+o.options.radius,o.centerY=o.controller.getBoundingClientRect().top+o.options.radius},this.options=Object.assign(this.options,t),this.onMove=n,this.validate(),this.init()}return t.prototype.validate=function(){var t=this;window[n]&&window[n].length>0&&window[n].some((function(e){return e.options.dynamicPosition&&(e.options.dynamicPositionTarget||document)===(t.options.dynamicPositionTarget||document)}))&&console.error("Multiple dynamicPosition should be used with different target elements (dynamicPositionTarget) to prevent event collision.")},t.prototype.init=function(){window[e]||(window[e]=new Set),this.id=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),window[n]=Object.assign(window[n]||[],[this]),this.style=document.createElement("style"),this.style.setAttribute("id","style-"+this.id),this.style.innerHTML="\n        .joystick-container-".concat(this.id," {\n            box-sizing: border-box;\n            position: fixed;\n            outline: none;\n            ").concat(this.options.leftToRight?"left":"right",": ").concat(this.options.x,";\n            ").concat(this.options.bottomToUp?"bottom":"top",": ").concat(this.options.y,";\n            transform: translate(").concat(this.options.dynamicPosition||this.options.leftToRight?"-50%":"50%",", ").concat(this.options.dynamicPosition||!this.options.bottomToUp?"-50%":"50%",");\n        }\n    \n        .joystick-controller-").concat(this.id," {\n            box-sizing: border-box;\n            outline: none;\n            opacity: ").concat(this.options.opacity,";\n            width: ").concat(2*this.options.radius,"px;\n            height: ").concat(2*this.options.radius,"px;\n            border-radius: 50%;\n            position: relative;\n            outline: 2px solid #4c4c4c77;\n            background: radial-gradient(circle,#ebebeb55, #5c5c5c55);\n        }\n    \n        .joystick-").concat(this.id," {\n            box-sizing: border-box;\n            outline: none;\n            position: absolute;\n            cursor: grab;\n            width: ").concat(2*this.options.joystickRadius,"px;\n            height: ").concat(2*this.options.joystickRadius,"px;\n            z-index: 1;\n            border-radius: 50%;\n            left: 50%;\n            bottom: 50%;\n            transform: translate(-50%, 50%);\n            background: radial-gradient(#000c, #3e3f46aa);\n            transition: ").concat(this.JOYSTICK_TRANSITION,";\n        }\n        "),this.container=document.createElement("div"),this.container.setAttribute("id","joystick-container-"+this.id),this.container.setAttribute("class","joystick-container-"+this.id+" "+this.options.containerClass),this.controller=document.createElement("div"),this.controller.setAttribute("id","joystick-controller-"+this.id),this.controller.setAttribute("class","joystick-controller-"+this.id+" "+this.options.controllerClass),this.joystick=document.createElement("div"),this.joystick.setAttribute("id","joystick-"+this.id),this.joystick.setAttribute("class","joystick-"+this.id+" "+this.options.joystickClass),this.controller.appendChild(this.joystick),this.container.appendChild(this.controller),document.head.appendChild(this.style),this.options.dynamicPosition||document.body.appendChild(this.container),this.addEventListeners(),this.recenterJoystick(),this.resetCoordinates()},t.prototype.destroy=function(){var t=this;if(this.options.dynamicPosition){var e=this.options.dynamicPositionTarget||document;e.removeEventListener("mousedown",this.dynamicPositioningMouse),document.removeEventListener("mouseup",this.removeDynamicPositioning),e.removeEventListener("touchstart",this.dynamicPositioningTouch),document.removeEventListener("touchmove",this.onTouchEvent),document.removeEventListener("touchend",this.removeDynamicPositioning)}else this.joystick.removeEventListener("touchstart",this.onStartEvent),this.joystick.removeEventListener("touchmove",this.onTouchEvent),this.joystick.removeEventListener("touchend",this.onStopEvent),this.joystick.removeEventListener("mousedown",this.onStartEvent);window.removeEventListener("resize",this.recenterJoystick),this.style.remove(),this.container.remove(),Array.isArray(window[n])&&(window[n]=window[n].filter((function(e){return e!==t})))},t}();t.MOUSE_CLICK_BUTTONS=i,t.default=o,Object.defineProperty(t,"__esModule",{value:!0})}));
